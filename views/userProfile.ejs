<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Profile</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.2.0/flowbite.min.css"
      rel="stylesheet"
    />
    <link
      href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css"
      rel="stylesheet"
    />
  </head>

  <body>
    <nav class="bg-white border-gray-200 dark:bg-gray-900">
      <div
        class="max-w-screen-xl flex flex-wrap items-center justify-between mx-auto p-4"
      >
        <a href="#" class="flex items-center space-x-3 rtl:space-x-reverse">
          <img
            src="/images/electronic-store-logo.svg"
            class="h-8"
            alt="OtronMart Logo"
          />
        </a>

        <div
          class="items-center justify-between hidden w-full md:flex md:w-auto md:order-1"
          id="navbar-search"
        >
          <ul
            class="flex flex-col p-4 md:p-0 mt-4 font-medium border border-gray-100 rounded-lg bg-gray-50 md:space-x-8 rtl:space-x-reverse md:flex-row md:mt-0 md:border-0 md:bg-white dark:bg-gray-800 md:dark:bg-gray-900 dark:border-gray-700"
          >
            <li>
              <a
                href="/"
                class="block py-2 px-3 text-white bg-blue-700 rounded md:bg-transparent md:text-blue-700 md:p-0 md:dark:text-blue-500"
                aria-current="page"
                >Home</a
              >
            </li>
            <li>
              <a
                href="#"
                class="block py-2 px-3 text-gray-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-blue-700 md:p-0 md:dark:hover:text-blue-500 dark:text-white dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent dark:border-gray-700"
                >Product</a
              >
            </li>

            <li>
              <a
                href="/cart"
                class="block py-2 px-3 text-gray-900 rounded hover:bg-gray-100 md:hover:bg-transparent md:hover:text-blue-700 md:p-0 dark:text-white md:dark:hover:text-blue-500 dark:hover:bg-gray-700 dark:hover:text-white md:dark:hover:bg-transparent dark:border-gray-700"
                >Cart</a
              >
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <main class="container mx-auto p-4">
      <div class="bg-white rounded-lg shadow-md p-4 max-w-md mx-auto">
        <h2 class="text-2xl font-bold mb-4 text-center">Your Profile</h2>

        <div class="w-full mb-4 md:w-1/2 md:mb-0">
          <h3 class="text-xl font-bold mb-4">Account Information</h3>
          <p>Name: <%= user.name %></p>
          <p>Email: <%= user.email %></p>
          <% if (user.verified==false) { %>

          <a href="/otpentry">
            <button
              type="submit"
              class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded"
            >
              Verify
            </button>
          </a>
          <% } %>
          <p>Phone Number: <%= user.phoneNumber %></p>
        </div>

        <hr class="mt-5 mb-5" />

        <div class="w-full md:w-1/2">
          <h3 class="text-xl font-bold mb-6">Manage Your Account</h3>
          <div>
            <button
              id="openModal"
              class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded"
            >
              Edit Profile
            </button>
          </div>

          <!-- Modal overlay -->
          <div
            id="modalOverlay"
            class="hidden fixed inset-0 bg-gray-600 bg-opacity-75 z-50"
          ></div>

          <!-- Modal container -->
          <div
            id="modalContainer"
            class="hidden fixed inset-0 flex items-center justify-center z-50"
          >
            <!-- Modal content -->
            <div class="bg-white p-8 rounded shadow-lg w-96">
              <h2 class="text-xl font-bold mb-4">Edit Profile</h2>

              <!-- Input fields -->
              <div class="mb-4">
                <label for="name" class="block text-gray-700">Name</label>
                <input
                  type="text"
                  id="name"
                  class="w-full border p-2"
                  value="<%= user.name %>"
                />
              </div>

              <div class="mb-4">
                <label for="email" class="block text-gray-700">Email</label>
                <input
                  type="email"
                  id="email"
                  class="w-full border p-2"
                  value="<%= user.email %>"
                  disabled
                />
              </div>
              <div class="mb-4">
                <label for="phone" class="block text-gray-700"
                  >Phone Number</label
                >
                <input
                  type="number"
                  id="phone"
                  class="w-full border p-2"
                  value="<%= user.phoneNumber %>"
                />
              </div>

              <div class="gap-5">
                <!-- Submit button -->
                <button
                  id="submitButton"
                  class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"
                >
                  Submit
                </button>

                <!-- Close button -->
                <button
                  id="closeModal"
                  class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"
                >
                  close
                </button>
              </div>
            </div>
          </div>

          <div class="mt-5">
            <a
              href="/address"
              class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"
              >Manage Address</a
            >
          </div>
          <div class="mt-5">
            <a
              href="/wallet"
              class="bg-lime-500 hover:bg-lime-700 text-white font-bold py-2 px-4 rounded"
              >Wallet</a
            >
          </div>

          <div class="mt-5">
            <a
              href="/orders"
              class="bg-orange-500 hover:bg-orange-700 text-white font-bold py-2 px-4 rounded"
              >My Orders</a
            >
          </div>
          <div class="mt-5">
            <button
              id="changePasswordBtn"
              class="bg-gray-500 hover:bg-gray-700 text-gray-800 font-bold py-2 px-4 rounded"
            >
              Change Password
            </button>
          </div>

          <!-- Modal -->
          <div
            id="passwordModal"
            class="fixed z-10 inset-0 overflow-y-auto hidden"
          >
            <div
              class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"
            >
              <div class="fixed inset-0 transition-opacity" aria-hidden="true">
                <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
              </div>
              <span
                class="hidden sm:inline-block sm:align-middle sm:h-screen"
                aria-hidden="true"
                >&#8203;</span
              >

              <div
                class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"
                role="dialog"
                aria-modal="true"
                aria-labelledby="modal-headline"
              >
                <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                  <div class="sm:flex sm:items-start">
                    <div
                      class="mx-auto flex-shrink-0 flex items-center justify-center h-12 w-12 rounded-full bg-gray-100 sm:mx-0 sm:h-10 sm:w-10"
                    >
                      <svg
                        class="h-6 w-6 text-gray-400"
                        xmlns="http://www.w3.org/2000/svg"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        aria-hidden="true"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M12 9v2m0 4h.01m-6.938-7.532a9 9 0 1 1 11.872 0A7 7 0 0 1 12 17a7 7 0 0 1-7-7 7 7 0 0 1 5.062-6.71 5.5 5.5 0 1 1 5.876 0A9 9 0 0 1 5.062 6.468L2 9m20 3a10 10 0 1 1-20 0 4 4 0 0 1 8 0 4 4 0 0 1 8 0 4 4 0 0 1 8 0z"
                        />
                      </svg>
                    </div>
                    <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
                      <h3
                        class="text-lg leading-6 font-medium text-gray-900"
                        id="modal-headline"
                      >
                        Change Password
                      </h3>
                      <div class="mt-2">
                        <form id="changePasswordForm">
                          <div class="grid grid-cols-1 gap-6">
                            <div class="col-span-3 sm:col-span-2">
                              <label
                                for="currentPassword"
                                class="block text-sm font-medium text-gray-700"
                                >Current Password</label
                              >
                              <span
                                id="invalidpasserr"
                                class="text-center text-red-600 position-relative z-10 top-5 py-1.5 px-3 rounded-lg hidden"
                              ></span>
                              <input
                                type="password"
                                name="currentPassword"
                                id="currentPassword"
                                autocomplete="current-password"
                                class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md"
                              />
                              <span
                                id="passerr"
                                class="text-center text-red-600 position-relative z-10 top-5 py-1.5 px-3 rounded-lg hidden"
                              ></span>
                            </div>
                            <div class="col-span-3 sm:col-span-2">
                              <label
                                for="newPassword"
                                class="block text-sm font-medium text-gray-700"
                                >New Password</label
                              >
                              <input
                                type="password"
                                name="newPassword"
                                id="newPassword"
                                autocomplete="new-password"
                                class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md"
                              />
                              <span
                                id="newpasserr"
                                class="text-center text-red-600 position-relative z-10 top-5 py-1.5 px-3 rounded-lg hidden"
                              ></span>
                            </div>
                            <div class="col-span-3 sm:col-span-2">
                              <label
                                for="confirmPassword"
                                class="block text-sm font-medium text-gray-700"
                                >Confirm Password</label
                              >
                              <input
                                type="password"
                                name="confirmPassword"
                                id="confirmPassword"
                                autocomplete="new-password"
                                class="mt-1 focus:ring-indigo-500 focus:border-indigo-500 block w-full shadow-sm sm:text-sm border-gray-300 rounded-md"
                              />

                              <span
                                id="passworderror"
                                class="text-center text-red-600 position-relative z-10 top-5 py-1.5 px-3 rounded-lg hidden"
                              ></span>
                            </div>
                          </div>
                        </form>
                      </div>
                    </div>
                  </div>
                </div>

                <div
                  class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"
                >
                  <button
                    type="button"
                    id="submitPasswordBtn"
                    class="w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:ml-3 sm:w-auto sm:text-sm"
                  >
                    Submit
                  </button>
                  <button
                    type="button"
                    id="closePasswordModalBtn"
                    class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"
                  >
                    Close
                  </button>
                </div>
              </div>
            </div>
          </div>
          <div class="mt-4">
            <a href="/logout">
              <button
                type="submit"
                class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded"
              >
                Logout
              </button>
            </a>
          </div>
        </div>
      </div>
    </main>
    <footer
      class="bg-gray-800 text-white p-4 text-center mt-8 fixed bottom-0 w-full"
    >
      <p>
        &copy;
        <script>
          document.write(new Date().getFullYear());
        </script>
        OtronMart E-Commerce. All rights reserved.
      </p>
    </footer>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.2.0/flowbite.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.4/axios.min.js"
      integrity="sha512-ANd7ZJmixP2T0hxOP4bS6hkci01fxyrQSyRdaY7IsWq1WlKsD0WwWBDVDZbnMR7CJZVKCTkDx/q5D5n2C2C+vg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
      document
        .getElementById("openModal")
        .addEventListener("click", function () {
          document.getElementById("modalOverlay").classList.remove("hidden");
          document.getElementById("modalContainer").classList.remove("hidden");
        });

      document
        .getElementById("closeModal")
        .addEventListener("click", function () {
          document.getElementById("modalOverlay").classList.add("hidden");
          document.getElementById("modalContainer").classList.add("hidden");
        });

      document
        .getElementById("submitButton")
        .addEventListener("click", async function () {
          const name = document.getElementById("name").value;
          const email = document.getElementById("email").value;
          const phoneNumber = document.getElementById("phone").value;

          axios
            .post("/updateprofile", { name, email, phoneNumber })
            .then((response) => {
              if (response.data.success) {
                Swal.fire(
                  "Successfully Updated",
                  "Click the button",
                  "success"
                ).then(() => {
                  window.location.reload();
                });
                // Profile updated successfully, close the modal or show a success message
                console.log("Profile updated successfully");
              } else {
                // Handle errors, show an error message, etc.
                console.error("Failed to update profile");
              }
            })
            .catch((error) => {
              console.error("Error:", error);
            });
        });

      document
        .getElementById("changePasswordBtn")
        .addEventListener("click", function () {
          document.getElementById("passwordModal").classList.remove("hidden");
        });

      document
        .getElementById("closePasswordModalBtn")
        .addEventListener("click", function () {
          document.getElementById("passwordModal").classList.add("hidden");
          // Clear input fields
          document.getElementById("currentPassword").value = "";
          document.getElementById("newPassword").value = "";
          document.getElementById("confirmPassword").value = "";

          document.getElementById("passworderror").innerHTML = "";
          document.getElementById("currentpass").innerHTML = "";
          document.getElementById("newpasserr").innerHTML = "";
        });

      document
        .getElementById("submitPasswordBtn")
        .addEventListener("click", function () {
          const currentPassword =
            document.getElementById("currentPassword").value;
          const newPassword = document.getElementById("newPassword").value;
          const confirmPassword =
            document.getElementById("confirmPassword").value;

          const passworderror = document.getElementById("passworderror");
          const currentpass = document.getElementById("passerr");
          const newpasserr = document.getElementById("newpasserr");


          if (!currentPassword) {
            currentpass.classList.remove("hidden");
            currentpass.innerHTML = "Required Current Password";
          }

          if (!newPassword) {
            newpasserr.classList.remove("hidden");
            newpasserr.innerHTML = "Required New Password";
          }

          if (!confirmPassword) {
            passworderror.classList.remove("hidden");
            passworderror.innerHTML = "Required Confirm Password";
          }

          if (newPassword !== confirmPassword) {
            passworderror.classList.remove("hidden");
            passworderror.innerHTML =
              "New Password and Confirm Password doesnot match";
          }
          axios
            .post("/changepassword", {
              currentPassword,
              newPassword,
            })
            .then((response) => {
              console.log(response.data.message);
              document.getElementById("passwordModal").classList.add("hidden");

              // Clear input fields
              document.getElementById("currentPassword").value = "";
              document.getElementById("newPassword").value = "";
              document.getElementById("confirmPassword").value = "";

              document.getElementById("passworderror").innerHTML = "";
              document.getElementById("currentpass").innerHTML = "";
              document.getElementById("newpasserr").innerHTML = "";
            })
            .catch((error) => {
              console.error(
                "Error changing password:",
                error.response.data.error
              );
              // let invalidpasserr = document.getElementById('invalidpasserr')
              currentpass.classList.remove("hidden");
              currentpass.innerHTML = error.response.data.error;
            });
        });
    </script>
  </body>
</html>
